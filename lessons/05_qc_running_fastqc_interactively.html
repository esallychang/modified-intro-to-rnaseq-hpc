<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Quality control using FASTQC | GitHub Pages Test</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Quality control using FASTQC" />
<meta name="author" content="Modified by Sally Chang @ NICHD" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introduction to bulk RNA-seq" />
<meta property="og:description" content="Introduction to bulk RNA-seq" />
<link rel="canonical" href="https://esallychang.github.io/modified-intro-to-rnaseq-hpc/lessons/05_qc_running_fastqc_interactively.html" />
<meta property="og:url" content="https://esallychang.github.io/modified-intro-to-rnaseq-hpc/lessons/05_qc_running_fastqc_interactively.html" />
<meta property="og:site_name" content="GitHub Pages Test" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-10-03T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Quality control using FASTQC" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Modified by Sally Chang @ NICHD"},"dateModified":"2024-10-03T00:00:00+00:00","datePublished":"2024-10-03T00:00:00+00:00","description":"Introduction to bulk RNA-seq","headline":"Quality control using FASTQC","mainEntityOfPage":{"@type":"WebPage","@id":"https://esallychang.github.io/modified-intro-to-rnaseq-hpc/lessons/05_qc_running_fastqc_interactively.html"},"url":"https://esallychang.github.io/modified-intro-to-rnaseq-hpc/lessons/05_qc_running_fastqc_interactively.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/modified-intro-to-rnaseq-hpc/assets/css/style.css?v=b507c6c38fbc65ecc2e6abea386dbda0aeab8b3b">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/modified-intro-to-rnaseq-hpc/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">Quality control using FASTQC</h1>
      <h2 class="project-tagline">Introduction to bulk RNA-seq</h2>
      
        <a href="https://github.com/esallychang/modified-intro-to-rnaseq-hpc" class="btn">View on GitHub</a>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <h2 id="learning-objectives">Learning Objectives:</h2>

<ul>
  <li>Describe the contents and format of a FASTQ file</li>
  <li>Create a quality report using FASTQC</li>
</ul>

<h2 id="quality-control-of-fastq-files">Quality Control of FASTQ files</h2>

<p>The first step in the RNA-Seq workflow is to take the FASTQ files received from the sequencing facility and assess the quality of the sequence reads.</p>

<p align="center">

<img src="../img/rnaseq_salmon_workflow.png" width="400" />

</p>

<h3 id="unmapped-read-data-fastq">Unmapped read data (FASTQ)</h3>

<p>The <a href="https://en.wikipedia.org/wiki/FASTQ_format">FASTQ</a> file format is the defacto file format for sequence reads generated from next-generation sequencing technologies. This file format evolved from FASTA in that it contains sequence data, but also contains quality information. Similar to FASTA, the FASTQ file begins with a header line. The difference is that the FASTQ header is denoted by a <code class="language-plaintext highlighter-rouge">@</code> character. For a single record (sequence read), there are four lines, each of which are described below:</p>

<table>
  <thead>
    <tr>
      <th>Line</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Always begins with ‘\@’, followed by information about the read</td>
    </tr>
    <tr>
      <td>2</td>
      <td>The actual DNA sequence</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Always begins with a ‘+’, and sometimes the same info as in line 1</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Has a string of characters representing the quality scores; must have same number of characters as line 2</td>
    </tr>
  </tbody>
</table>

<p>Let’s use the following read as an example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@HWI-ST330:304:H045HADXX:1:1101:1111:61397
CACTTGTAAGGGCAGGCCCCCTTCACCCTCCCGCTCCTGGGGGANNNNNNNNNNANNNCGAGGCCCTGGGGTAGAGGGNNNNNNNNNNNNNNGATCTTGG
+
@?@DDDDDDHHH?GH:?FCBGGB@C?DBEGIIIIAEF;FCGGI#########################################################
</code></pre></div></div>

<p>The line 4 has characters encoding the quality of each nucleotide in the read. The legend below provides the mapping of quality scores (Phred-33) to the quality encoding characters. <em>Different quality encoding scales exist (differing by offset in the ASCII table), but note the most commonly used one is fastqsanger, which is the scale output by Illumina since mid-2011.</em></p>

<p><code class="language-plaintext highlighter-rouge">Quality encoding: !"#$%&amp;'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHI``|         |         |         |         |</code></p>

<p><code class="language-plaintext highlighter-rouge">Quality score:    0........10........20........30........40</code></p>

<p>Using the quality encoding character legend, the first nucelotide in the read (C) is called with a quality score of 31 (corresponding to encoding character <code class="language-plaintext highlighter-rouge">@</code>), and our Ns are called with a score of 2 (corresponding to encoding character <code class="language-plaintext highlighter-rouge">#</code>). <strong>As you can tell by now, this is a bad read.</strong></p>

<p>Each quality score represents the probability that the corresponding nucleotide call is incorrect. This quality score is logarithmically based and is calculated as:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Q = -10 x log10(P), where P is the probability that a base call is erroneous
</code></pre></div></div>

<p>These probabaility values are the results from the base calling algorithm and dependent on how much signal was captured for the base incorporation. The score values can be interpreted as follows:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Phred Quality Score</th>
      <th style="text-align: center">Probability of incorrect base call</th>
      <th style="text-align: center">Base call accuracy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">10</td>
      <td style="text-align: center">1 in 10</td>
      <td style="text-align: center">90%</td>
    </tr>
    <tr>
      <td style="text-align: center">20</td>
      <td style="text-align: center">1 in 100</td>
      <td style="text-align: center">99%</td>
    </tr>
    <tr>
      <td style="text-align: center">30</td>
      <td style="text-align: center">1 in 1000</td>
      <td style="text-align: center">99.9%</td>
    </tr>
    <tr>
      <td style="text-align: center">40</td>
      <td style="text-align: center">1 in 10,000</td>
      <td style="text-align: center">99.99%</td>
    </tr>
  </tbody>
</table>

<p>Therefore, for the first nucleotide in the read (C), there is less than a 1 in 1000 chance that the base was called incorrectly. Whereas, for the the end of the read there is greater than 50% probability that the base is called incorrectly.</p>

<h2 id="assessing-quality-with-fastqc">Assessing quality with FastQC</h2>

<p>Now that we understand what information is stored in a FASTQ file, the next step is to examine quality metrics for our data.</p>

<p><a href="http://www.bioinformatics.babraham.ac.uk/projects/fastqc/">FastQC</a> provides a simple way to do some quality checks on raw sequence data coming from high throughput sequencing pipelines. It provides a modular set of analyses, which you can use to obtain an impression of whether your data has any problems that you should be aware of before moving on to the next analysis.</p>

<p>FastQC does the following: * accepts FASTQ files (or BAM files) as input * generates summary graphs and tables to help assess your data * generates an easy-to-view HTML-based report with the graphs and tables</p>

<hr />

<blockquote>
  <p>NOTE: Before we run FastQC, <strong>you should be on a compute node</strong> in an interactive session. Please run the following <code class="language-plaintext highlighter-rouge">srun</code> command if you are not on a compute node. We will start with the default <code class="language-plaintext highlighter-rouge">sinteractive</code> allocation which is 1 core (2 CPUs) and 768 MB/CPU (1.5 GB) of memory, which should be just fine for our purposes. See this <a href="https://hpc.nih.gov/docs/userguide.html#int">Biowulf page</a> for more information.</p>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="c">#srun --pty -p interactive -t 0-3:00 --mem 1G --reservation=HBC1 /bin/bash</span>
<span class="nv">$ </span>sinteractive 
</code></pre></div>  </div>

  <p><strong><em>An interactive session is very useful to test tools and workflows.</em></strong></p>
</blockquote>

<h3 id="run-fastqc">Run FastQC</h3>

<p>Before we start using software, we have to load the module for each tool. On Biowulf, this is done using an <strong>LMOD</strong> system.</p>

<p>If we check which modules we currently have loaded, we should not see FastQC.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>module list
</code></pre></div></div>

<p>This is because the FastQC program is not in our $PATH (i.e. it’s not in a directory that shell will automatically check to run commands/programs).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$PATH</span>
</code></pre></div></div>

<p>To run the FastQC program, we first need to load the appropriate module, so it puts the program into our path. To find the FastQC module to load we need to search the versions available:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>module spider fastqc
</code></pre></div></div>

<p>Once we know which version we want to use (0.12.1), we can load the FastQC module:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>module load fastqc/0.12.1
</code></pre></div></div>

<p>Once a module for a tool is loaded, you have essentially made it directly available to you like any other basic shell command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>module list

<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$PATH</span>
</code></pre></div></div>

<p>Now, let’s create a directory to store the output of FastQC:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir </span>results/fastqc
</code></pre></div></div>

<p>We will need to specify this directory in the command to run FastQC. How do we know which argument to use?</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>fastqc <span class="nt">--help</span>
</code></pre></div></div>

<blockquote>
  <p><strong>NOTE:</strong> From the help manual, we know that <code class="language-plaintext highlighter-rouge">-o</code> (or <code class="language-plaintext highlighter-rouge">--outdir</code>) will create all output files in the specified output directory. Note that another argument, <code class="language-plaintext highlighter-rouge">-t</code>, specifies the number of files which can be processed simultaneously. We will use <code class="language-plaintext highlighter-rouge">-t</code> argument later. You may explore other arguments as well based on your needs.</p>
</blockquote>

<p>FastQC will accept multiple file names as input, so we can use the <code class="language-plaintext highlighter-rouge">*.fq</code> wildcard.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd </span>raw_data
<span class="nv">$ </span>fastqc <span class="nt">-o</span> ~/rnaseq/results/fastqc/ <span class="k">*</span>.fq
<span class="c"># perl: warning: Falling back to a fallback locale ("C.UTF-8"). I think this is fine?</span>
</code></pre></div></div>

<p><em>Did you notice how each file was processed pretty much serially? How do we speed this up?</em></p>

<p>FastQC has the capability of splitting up a single process to run on multiple cores! To do this, we will need to specify an additional argument <code class="language-plaintext highlighter-rouge">-t</code> indicating number of cores. We will also need to exit the current interactive session, since we started this interactive session with only the default 2 cores (CPUs). We cannot have a tool to use more cores than requested on a compute node.</p>

<p>Exit the interactive session and start a new one with 6 cores:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">exit</span>  <span class="c">#exit the current interactive session (you will be back on a login node)</span>
<span class="nv">$ </span>sinteractive <span class="nt">--cpus-per-task</span> 6 <span class="nt">--mem</span><span class="o">=</span>2G
<span class="nv">$ </span><span class="c">#srun --pty -c 6 -p interactive -t 0-3:00 --mem 2G --reservation=HBC1 /bin/bash  #start a new one with 6 cores (-c 6) and 2GB RAM (--mem 2G)</span>
<span class="nv">$ </span><span class="c"># Could also be a good opportunity to use tmux to keep our interactive session alive</span>
</code></pre></div></div>

<p>Once you are on the compute node, check what job(s) you have running and what resources you are using.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>squeue <span class="nt">-u</span> <span class="nv">$USER</span>
</code></pre></div></div>

<p>Now that we are in a new interactive session with the appropriate resources, we will need to load the module again for this new session.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>module load fastqc/0.12.1  <span class="c">#reload the module for the new (6-core) interactive session</span>
</code></pre></div></div>

<p>We will also move into the <code class="language-plaintext highlighter-rouge">raw_data</code> directory (remember we are on a new compute node now):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd </span>raw_data/
</code></pre></div></div>

<p>Run FastQC and use the multi-threading functionality of FastQC to run 6 jobs at once (with an additional argument <code class="language-plaintext highlighter-rouge">-t</code>).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>fastqc <span class="nt">-o</span> ~/rnaseq/results/fastqc/ <span class="nt">-t</span> 6 <span class="k">*</span>.fq  <span class="c">#note the extra parameter we specified for 6 threads</span>
</code></pre></div></div>

<p><em>Do you notice a difference? Is there anything in the ouput that suggests this is no longer running serially?</em></p>

<hr />

<p><em>This lesson has been developed by members of the teaching team at the <a href="http://bioinformatics.sph.harvard.edu/">Harvard Chan Bioinformatics Core (HBC)</a>. These are open access materials distributed under the terms of the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution license</a> (CC BY 4.0), which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</em></p>

<ul>
  <li><em>The materials used in this lesson was derived from work that is Copyright © Data Carpentry (<a href="http://datacarpentry.org/">http://datacarpentry.org/</a>). All Data Carpentry instructional material is made available under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution license</a> (CC BY 4.0).</em></li>
</ul>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/esallychang/modified-intro-to-rnaseq-hpc">modified-intro-to-rnaseq-hpc</a> is maintained by <a href="https://github.com/esallychang">esallychang</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>
  </body>
</html>
