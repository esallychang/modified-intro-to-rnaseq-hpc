<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Quantification of transcript abundance using Salmon | GitHub Pages Test</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Quantification of transcript abundance using Salmon" />
<meta name="author" content="Mary Piper, Meeta Mistry, Radhika Khetani, Jihe Liu - edited by Sally Chang @ NICHD" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introduction to bulk RNA-seq" />
<meta property="og:description" content="Introduction to bulk RNA-seq" />
<link rel="canonical" href="https://esallychang.github.io/modified-intro-to-rnaseq-hpc/modified-intro-march2025/lessons/09_quasi_alignment_salmon_sbatch.html" />
<meta property="og:url" content="https://esallychang.github.io/modified-intro-to-rnaseq-hpc/modified-intro-march2025/lessons/09_quasi_alignment_salmon_sbatch.html" />
<meta property="og:site_name" content="GitHub Pages Test" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-10-07T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Quantification of transcript abundance using Salmon" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Mary Piper, Meeta Mistry, Radhika Khetani, Jihe Liu - edited by Sally Chang @ NICHD"},"dateModified":"2024-10-07T00:00:00+00:00","datePublished":"2024-10-07T00:00:00+00:00","description":"Introduction to bulk RNA-seq","headline":"Quantification of transcript abundance using Salmon","mainEntityOfPage":{"@type":"WebPage","@id":"https://esallychang.github.io/modified-intro-to-rnaseq-hpc/modified-intro-march2025/lessons/09_quasi_alignment_salmon_sbatch.html"},"url":"https://esallychang.github.io/modified-intro-to-rnaseq-hpc/modified-intro-march2025/lessons/09_quasi_alignment_salmon_sbatch.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/modified-intro-to-rnaseq-hpc/modified-intro-march2025/assets/css/style.css?v=b507c6c38fbc65ecc2e6abea386dbda0aeab8b3b">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/modified-intro-to-rnaseq-hpc/modified-intro-march2025/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">Quantification of transcript abundance using Salmon</h1>
      <h2 class="project-tagline">Introduction to bulk RNA-seq</h2>
      
        <a href="https://github.com/esallychang/modified-intro-to-rnaseq-hpc" class="btn">View on GitHub</a>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <p>Approximate time: 30 minutes</p>

<h2 id="learning-objectives">Learning Objectives</h2>

<ul>
  <li>Create a job submission script to run Salmon on all samples in the dataset</li>
</ul>

<h2 id="running-salmon-on-multiple-samples">Running Salmon on multiple samples</h2>

<p>In class we talked in depth about how the Salmon algorithm works, and provided the command required to run Salmon on a single sample. In this lesson we walk through the steps required to <strong>efficiently run Salmon on all samples</strong> in the dataset. Unlike our experience with FastQC, where we could use one command and simply provide all files with the use of a wildcard (<code class="language-plaintext highlighter-rouge">*</code>), Salmon is only able to take a single file as input.</p>

<p>Rather than typing out the Salmon command six times, we will use <strong>a for loop to iterate over all FASTQ files in our dataset</strong> (inside the <code class="language-plaintext highlighter-rouge">raw_fastq</code> directory). Furthermore, rather than running this <code class="language-plaintext highlighter-rouge">for</code> loop interactively, we will put the it inside a text file and create a <strong>job submission script</strong>.</p>

<h3 id="create-a-job-submission-script-to-run-salmon-in-serial">Create a job submission script to run Salmon in serial</h3>

<p>Let’s start by opening up a text file in <code class="language-plaintext highlighter-rouge">vim</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ vim salmon_all_samples.sbatch
</code></pre></div></div>

<p>Begin the script starting with the <strong>shebang line</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
</code></pre></div></div>

<hr />

<p><strong>Exercise 1</strong></p>

<ol>
  <li>Add the Slurm directives ( i.e <code class="language-plaintext highlighter-rouge">#SBATCH</code>) to request specific resources for our job. The resources we need are listed below.</li>
</ol>

<blockquote>
  <p><strong>NOTE:</strong> Helpful resources include: * This <a href="/modified-intro-to-rnaseq-hpc/modified-intro-march2025/lessons/03_working_on_HPC.html#requesting-resources-from-slurm">linked lesson</a> * <a href="https://hpc.nih.gov/docs/biowulf-cheat-sheet.pdf">Biowulf SBATCH Cheat Sheet</a> and this <a href="https://hpc.nih.gov/docs/userguide.html#submit">Biowulf help page</a></p>
</blockquote>

<ul>
  <li>Your job will use the default (<code class="language-plaintext highlighter-rouge">norm</code>) partition, NOT the short partition</li>
  <li>Request 6 cores to take advantage of Salmon’s multi-threading capabilities</li>
  <li>Request 12 hours of runtime</li>
  <li>Request 8G of memory</li>
  <li>Give your job the name <code class="language-plaintext highlighter-rouge">salmon_in_serial</code></li>
  <li>Add an email and request to be notified when the job is complete</li>
</ul>

<hr />

<p>Now that we have the resources requested, we can begin to <strong>add the commands into our shell script</strong>.</p>

<hr />

<p><strong>Exercise 2</strong></p>

<ol>
  <li>Add a line of code required to load the Salmon module</li>
  <li>Add a line of code to change directories to where the Salmon results will be output (be sure to use a full path here).</li>
</ol>

<blockquote>
  <p><em>Add comments to your script liberally, wherever you feel it’s needed.</em></p>
</blockquote>

<hr />

<p>The last piece of the shell script is the <strong>for loop</strong> code provided below. <strong>Copy and paste this into your script</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for </span>fq <span class="k">in</span> ~/rnaseq/raw_data/<span class="k">*</span>.fq

<span class="k">do</span>

<span class="c"># create a prefix for the output file</span>
<span class="nv">samplename</span><span class="o">=</span><span class="sb">`</span><span class="nb">basename</span> <span class="nv">$fq</span> .fq<span class="sb">`</span>

<span class="c"># run salmon</span>
salmon quant <span class="nt">-i</span> /data/changes/rc_training/rnaseq/references/salmon_index <span class="se">\</span>
 <span class="nt">-l</span> A <span class="se">\</span>
 <span class="nt">-r</span> <span class="nv">$fq</span> <span class="se">\</span>
 <span class="nt">-o</span> <span class="k">${</span><span class="nv">samplename</span><span class="k">}</span>_salmon <span class="se">\</span>
 <span class="nt">--seqBias</span> <span class="se">\</span>
 <span class="nt">--useVBOpt</span> <span class="se">\</span>
 <span class="nt">--validateMappings</span>

<span class="k">done</span>
</code></pre></div></div>

<p>Note, that our for loop is iterating over all FASTQ files in the <code class="language-plaintext highlighter-rouge">raw_fastq</code> directory. For each file, a prefix is generated to name the output file and then the Salmon command is run with the same parameters as used in the single sample run.</p>

<hr />

<p><strong>Exercise 3</strong></p>

<ol>
  <li>
    <p>Add two additional parameters (as described below) to the current Salmon command (<em>remember to use “<code class="language-plaintext highlighter-rouge">\</code>” if dissecting one command in multiple lines</em>):</p>

    <ol>
      <li><code class="language-plaintext highlighter-rouge">-p</code>: specifies the number of processors or cores we would like to use for <strong>multi-threading</strong>. What value will you provide here, knowing what we asked for in our Slurm directives?</li>
      <li><code class="language-plaintext highlighter-rouge">--numBootstraps</code>: specifies computation of bootstrapped abundance estimates. <strong>Bootstraps are required for isoform level differential expression analysis for estimation of technical variance</strong>. Here, you can set the value to 30.</li>
    </ol>
  </li>
</ol>

<blockquote>
  <p><em><strong>NOTE:</strong><code class="language-plaintext highlighter-rouge">--numBootstraps</code> is necessary if performing <strong>isoform-level differential expression analysis</strong> with Sleuth, but not for gene-level differential expression analysis. Due to the statistical procedure required to assign reads to gene isoforms, in addition to the random processes underlying RNA-Seq, there will be <strong>technical variability in the abundance estimates</strong> output from the pseudo-alignment tool [<a href="https://rawgit.com/pachterlab/sleuth/master/inst/doc/intro.html">2</a>, <a href="https://www.nature.com/articles/nmeth.4324">3</a>] for the isoform level abundance estimates (not necessary for gene-level estimates). Therefore, <strong>we would need technical replicates to distinguish technical variability from the biological variability</strong> for gene isoforms.</em></p>

  <p><em>The bootstraps estimate technical variation per gene by calculating the abundance estimates for all genes using a different sub-sample of reads during each round of bootstrapping. The variation in the abundance estimates output from each round of bootstrapping is used for the estimation of the technical variance for each gene.</em></p>
</blockquote>

<ol>
  <li>Save and close the script. This script is now ready to run.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sbatch salmon_all_samples.sbatch
</code></pre></div></div>

<ol>
  <li><strong>After you confirmed that the script runs as expected, copy and paste your final script to <a href="https://docs.google.com/forms/d/e/1FAIpQLScxaj3IIO4Bx7FCRw87cCeuTPQyhD_7WR2QU638y8IZDv5r1A/viewform?usp=sf_link">Google forms</a>.</strong></li>
</ol>

<hr />

<p><em>This lesson has been developed by members of the teaching team at the <a href="http://bioinformatics.sph.harvard.edu/">Harvard Chan Bioinformatics Core (HBC)</a>. These are open access materials distributed under the terms of the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution license</a> (CC BY 4.0), which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</em></p>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/esallychang/modified-intro-to-rnaseq-hpc">modified-intro-to-rnaseq-hpc</a> is maintained by <a href="https://github.com/esallychang">esallychang</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>
  </body>
</html>
